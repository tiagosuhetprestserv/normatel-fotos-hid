<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Foto com GPS, Data e Troca de C√¢mera</title>
  https://unpkg.com/leaflet@1.9.4/dist/leaflet.css
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 10px;
    }
    video, canvas, #mapa {
      width: 100%;
      max-width: 400px;
      border-radius: 8px;
    }
    #mapa {
      height: 300px;
      margin-top: 15px;
    }
    .controls {
      margin-top: 15px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    button, a {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #0078D4;
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    button:hover, a:hover {
      background-color: #005A9E;
    }
    #localizacao, #infoTexto {
      margin-top: 15px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h2>Captura de Evid√™ncia com GPS e Data</h2>
  <video id="video" autoplay playsinline></video>

  <div class="controls">
    <button onclick="trocarCamera()">üîÑ Trocar C√¢mera</button>
    <button onclick="tirarFoto()">üì∏ Tirar Foto</button>
    <a id="downloadLink" style="display:none;">‚¨áÔ∏è Baixar Foto</a>
    <button onclick="compartilharFoto()" id="shareBtn" style="display:none;">üì§ Compartilhar</button>
  </div>

  <canvas id="canvas"></canvas>
  <p id="localizacao">üìç Localiza√ß√£o: (aguardando...)</p>
  <p id="infoTexto" style="display:none;"></p>
  <div id="mapa"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
eo = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const localizacao = document.getElementById('localizacao');
    const infoTexto = document.getElementById('infoTexto');
    const downloadLink = document.getElementById('downloadLink');
    const shareBtn = document.getElementById('shareBtn');
    let usandoFrontal = true;
    let streamAtual = null;

    let latitudeGlobal = "";
    let longitudeGlobal = "";
    let dataHoraGlobal = "";

    let mapa;
    let marcador;

    async function iniciarCamera() {
      if (streamAtual) {
        streamAtual.getTracks().forEach(track => track.stop());
      }

      const constraints = {
        video: {
          facingMode: usandoFrontal ? "user" : "environment"
        }
      };

      try {
        streamAtual = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = streamAtual;

        await new Promise(resolve => {
          video.onloadedmetadata = () => {
            video.play();
            resolve();
          };
        });
      } catch (err) {
        alert("Erro ao acessar c√¢mera: " + err);
      }
    }

    function trocarCamera() {
      usandoFrontal = !usandoFrontal;
      iniciarCamera();
    }

    function atualizarMapa(lat, lng) {
      const coordenadas = [parseFloat(lat), parseFloat(lng)];

      if (!mapa) {
        mapa = L.map('mapa').setView(coordenadas, 15);
